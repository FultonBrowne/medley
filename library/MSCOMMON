(DEFINE-FILE-INFO PACKAGE "INTERLISP" READTABLE "XCL" BASE 10)

(FILECREATED "29-Oct-2021 08:38:11" |{DSK}<home>larry>medley>library>MSCOMMON.;2| 14339  

      |changes| |to:|  (FNS FUNCTIONSMSGETDEF)

      |previous| |date:| " 4-May-92 13:10:53" |{DSK}<home>larry>medley>library>MSCOMMON.;1|)


; Copyright (c) 1988, 1990, 1992 by Venue & Xerox Corporation.

(PRETTYCOMPRINT MSCOMMONCOMS)

(RPAQQ MSCOMMONCOMS
       ((PROP FILETYPE MSCOMMON)
        (FNS FUNCTIONSMSGETDEF FUNCTIONSMSMC VARIABLESMSGETDEF)
        
        (* |;;| "Templates for CL stuff that need them.")

        (TEMPLATES ADD-EXEC CL:ADJOIN CL:ADJUST-ARRAY CL:APPLY CL:APPLYHOOK ASET CL:ASSOC CL:CLOSE 
               CLRHASH CL:COMPILE CL:COMPILE-FILE CL:COMPILER-LET CL:COUNT CL:COUNT-IF 
               CL:COUNT-IF-NOT CL:DECF DECLARE CL:DELETE CL:DELETE-DUPLICATES CL:DELETE-IF 
               CL:DELETE-IF-NOT CL:EVAL-WHEN CL:EVALHOOK EXEC EXEC-EVAL CL:FILL FILL-VECTOR CL:FIND 
               CL:FIND-IF CL:FIND-IF-NOT CL:FLET CL:FUNCTION CL:GETF CL:IN-PACKAGE CL:INCF 
               CL:INTERSECTION CL:LABELS CL:LOAD CL:MACROLET CL:MAKE-ARRAY COMPILER:MAKE-CONTEXT 
               CL:MAKE-HASH-TABLE CL:MAKE-LIST CL:MAKE-PACKAGE CL:MAKE-PATHNAME CL:MAKE-SEQUENCE 
               CL:MAKE-STRING CL:MAPC CL:MAPCAN CL:MAPCAR CL:MAPCON CL:MAPHASH CL:MAPL CL:MAPLIST 
               CL:MEMBER CL:MEMBER-IF CL:MEMBER-IF-NOT CL:MERGE CL:MISMATCH CL:MULTIPLE-VALUE-CALL 
               CL:MULTIPLE-VALUE-PROG1 CL:MULTIPLE-VALUE-SETQ CL:NINTERSECTION CL:NRECONC CL:NREVERSE
               CL:NSET-DIFFERENCE CL:NSET-EXCLUSIVE-OR CL:NSTRING-CAPITALIZE CL:NSTRING-DOWNCASE 
               CL:NSTRING-UPCASE CL:NSUBLIS CL:NSUBST CL:NSUBST-IF CL:NSUBST-IF-NOT CL:NSUBSTITUTE 
               CL:NSUBSTITUTE-IF CL:NSUBSTITUTE-IF-NOT CL:NUNION OPEN CL:PARSE-INTEGER 
               CL:PARSE-NAMESTRING CL:POP CL:POSITION CL:POSITION-IF CL:POSITION-IF-NOT CL:PROGV 
               CL:PSETF CL:PSETQ CL:PUSH CL:PUSHNEW CL:RASSOC CL:READ-FROM-STRING CL:REDUCE CL:REMF 
               CL:REMOVE CL:REMOVE-DUPLICATES CL:REMOVE-IF CL:REMOVE-IF-NOT CL:REPLACE CL:ROTATEF 
               CL:SEARCH CL:SET-DIFFERENCE CL:SET-EXCLUSIVE-OR CL:SHIFTF CL:SORT CL:STABLE-SORT 
               CL:STRING-CAPITALIZE CL:STRING-DOWNCASE STRING-EQUAL CL:STRING-GREATERP 
               CL:STRING-LESSP CL:STRING-NOT-EQUAL CL:STRING-NOT-GREATERP CL:STRING-NOT-LESSP 
               CL:STRING-UPCASE CL:STRING/= CL:STRING< CL:STRING<= CL:STRING= CL:STRING> CL:STRING>=
               CL:SUBLIS CL:SUBSETP CL:SUBST CL:SUBST-IF CL:SUBST-IF-NOT CL:SUBSTITUTE 
               CL:SUBSTITUTE-IF CL:SUBSTITUTE-IF-NOT CL:TREE-EQUAL CL:UNION CL:VECTOR-PUSH 
               CL:VECTOR-PUSH-EXTEND WRITE CL:WRITE-LINE CL:WRITE-STRING CL:WRITE-TO-STRING)
        (P 
           (* |;;| "First tell Masterscope how to find FUNCTIONS and VARIABLES")

           (MSADDANALYZE 'VARIABLES 'VARIABLE 'VARIABLES 'VARIABLESMSGETDEF)
           (MSADDANALYZE 'FUNCTIONS 'FUNCTION 'FUNCTIONS 'FUNCTIONSMSGETDEF 'FUNCTIONSMSMC)
           
           (* |;;| 
        "Then add KEYWORD support.  Templates may now contain the following as their last element:")

           
           (* |;;| "... KEYWORDS list of keywords accepted)")

           
           (* |;;| "No (list of keywords accepted) means use keywords gathered from analyzed source.  This must naturally be last in a template.")

           (MSADDRELATION '(ACCEPT ACCEPTS ACCEPTING ACCEPTED)
                  '(KEYACCEPT))
           (MSADDRELATION '(SPECIFY SPECIFIES SPECIFYING SPECIFIED)
                  '(KEYSPECIFY))
           (MSADDRELATION '(KEYCALL KEYCALLS KEYCALLING KEYCALLED))
           (MSADDMODIFIER 'ACCEPT 'KEYWORD 'KEYACCEPT)
           (MSADDMODIFIER 'ACCEPT 'KEYWORDS 'KEYACCEPT)
           (MSADDMODIFIER 'SPECIFY 'KEYWORD 'KEYSPECIFY)
           (MSADDMODIFIER 'SPECIFY 'KEYWORDS 'KEYSPECIFY)
           
           (* |;;| 
   "Stuff for locally-defined things.  We don't attempt to handle them (*sigh*), just record them.")

           (MSADDRELATION '(FLET FLETS FLETTING FLET))
           (MSADDRELATION '(LABEL LABELS LABELLING LABELLED))
           (MSADDRELATION '(MACROLET MACROLETS MACROLETTING MACROLET))
           (MSADDRELATION '(LOCAL-DEFINE LOCAL-DEFINES LOCAL-DEFINING LOCAL-DEFINED)
                  '(FLET LABEL MACROLET))
           
           (* |;;| "What the heck, track COMPILER-LETs.")

           (MSADDRELATION '(COMPILER-LET COMPILER-LETS COMPILER-LETTING COMPILER-LETTED))
           
           (* |;;| "Finally, copy the templates over into MSTEMPLATES and clear the USERTEMPLATES table now; no need for the Common Lisp templates to live there.")

           (MAPHASH USERTEMPLATES #'(LAMBDA (VAL KEY)
                                           (PUTHASH KEY VAL MSTEMPLATES)))
           (CLRHASH USERTEMPLATES))))

(PUTPROPS MSCOMMON FILETYPE :COMPILE-FILE)
(DEFINEQ

(FUNCTIONSMSGETDEF
  (LAMBDA (NAME TYPE SOURCE OPTIONS)                         (* \; 
                                                           "Edited 29-Oct-2021 08:37 by larry")
                                                             (* \; "Edited 31-Mar-88 17:31 by jrb:")
    (LET ((BODY (REMOVE-COMMENTS (GETDEF NAME 'FUNCTIONS SOURCE OPTIONS))))
         (AND BODY (SELECTQ (CAR BODY)
                       (DEFMACRO (OR (GETTEMPLATE NAME)
                                     (SETTEMPLATE NAME 'MACRO T))
                                 NIL)
                       (CL:DEFUN 
                                 (* |;;| "Body is of the form:")

                                 (* |;;| "(DEFUN name (args...) bodies...)")

                                 (* |;;| 
                               "We want to hand Masterscope a massaged form it will understand.")

                                 (* |;;| "Which I believe is of this form:")

                                 `(CL:LAMBDA ,(CADDR BODY)
                                         ,@(CDDDR BODY)))
                       NIL)))))

(FUNCTIONSMSMC
  (LAMBDA (NAME TYPE REASON)                             (* \; "Edited  1-Apr-88 13:47 by jrb:")
          (* |;;| "Trick here is we don't want to mark FUNCTIONS macros as changed because they really don't get analyzed, but we do want to call CHANGEMACRO for them")

    (|if| (EQ (CAR (GETDEF NAME 'FUNCTIONS NIL '(NOERROR)))
                  'DEFMACRO)
        |then| (CHANGEMACRO NAME TYPE REASON)
              NIL
      |else| T)))

(VARIABLESMSGETDEF
  (LAMBDA (NAME TYPE SOURCE OPTIONS)                     (* \; "Edited 19-Feb-88 19:46 by jrb:")

    (LET ((BODY (GETDEF NAME 'VARIABLES SOURCE OPTIONS))
          SPECVARP)
         (AND BODY 
          
          (* |;;| "We have to return something here so Masterscope can get hold of the init form, and so It'll stop looking for other things")

              `(CL:LAMBDA NIL ,(IF (CADDR BODY)
                                   THEN `(SETQ ,(CADR BODY) ,(CADDR BODY))))))))
)



(* |;;| "Templates for CL stuff that need them.")


(SETTEMPLATE 'ADD-EXEC NIL)

(SETTEMPLATE 'CL:ADJOIN NIL)

(SETTEMPLATE 'CL:ADJUST-ARRAY NIL)

(SETTEMPLATE 'CL:APPLY NIL)

(SETTEMPLATE 'CL:APPLYHOOK NIL)

(SETTEMPLATE 'ASET NIL)

(SETTEMPLATE 'CL:ASSOC NIL)

(SETTEMPLATE 'CL:CLOSE NIL)

(SETTEMPLATE 'CLRHASH NIL)

(SETTEMPLATE 'CL:COMPILE NIL)

(SETTEMPLATE 'CL:COMPILE-FILE NIL)

(SETTEMPLATE 'CL:COMPILER-LET '(! NIL (BOTH (|..| (IF LISTP (NIL EVAL |..| EFFECT)
                                                         NIL))
                                            (|..| (IF LISTP (BIND) BIND)))
                                  |..| EFFECT RETURN))

(SETTEMPLATE 'CL:COUNT NIL)

(SETTEMPLATE 'CL:COUNT-IF NIL)

(SETTEMPLATE 'CL:COUNT-IF-NOT NIL)

(SETTEMPLATE 'CL:DECF NIL)

(SETTEMPLATE 'DECLARE '(|..| (@ EXPR (CONS NIL (SELECTQ (CAR (LISTP EXPR))
                                                   (LOCALVARS '(IF LISTP (|..| LOCALVARS)
                                                                      LOCALVARS))
                                                   (SPECVARS '(IF LISTP (|..| SPECVARS)
                                                                     SPECVARS))
                                                   NIL)))))

(SETTEMPLATE 'CL:DELETE NIL)

(SETTEMPLATE 'CL:DELETE-DUPLICATES NIL)

(SETTEMPLATE 'CL:DELETE-IF NIL)

(SETTEMPLATE 'CL:DELETE-IF-NOT NIL)

(SETTEMPLATE 'CL:EVAL-WHEN NIL)

(SETTEMPLATE 'CL:EVALHOOK NIL)

(SETTEMPLATE 'EXEC NIL)

(SETTEMPLATE 'EXEC-EVAL NIL)

(SETTEMPLATE 'CL:FILL NIL)

(SETTEMPLATE 'FILL-VECTOR NIL)

(SETTEMPLATE 'CL:FIND NIL)

(SETTEMPLATE 'CL:FIND-IF NIL)

(SETTEMPLATE 'CL:FIND-IF-NOT NIL)

(SETTEMPLATE 'CL:FLET NIL)

(SETTEMPLATE 'CL:FUNCTION NIL)

(SETTEMPLATE 'CL:GETF NIL)

(SETTEMPLATE 'CL:IN-PACKAGE NIL)

(SETTEMPLATE 'CL:INCF NIL)

(SETTEMPLATE 'CL:INTERSECTION NIL)

(SETTEMPLATE 'CL:LABELS NIL)

(SETTEMPLATE 'CL:LOAD NIL)

(SETTEMPLATE 'CL:MACROLET NIL)

(SETTEMPLATE 'CL:MAKE-ARRAY NIL)

(SETTEMPLATE 'COMPILER:MAKE-CONTEXT NIL)

(SETTEMPLATE 'CL:MAKE-HASH-TABLE NIL)

(SETTEMPLATE 'CL:MAKE-LIST NIL)

(SETTEMPLATE 'CL:MAKE-PACKAGE NIL)

(SETTEMPLATE 'CL:MAKE-PATHNAME NIL)

(SETTEMPLATE 'CL:MAKE-SEQUENCE '(EVAL EVAL KEYWORDS :INITIAL-ELEMENT))

(SETTEMPLATE 'CL:MAKE-STRING NIL)

(SETTEMPLATE 'CL:MAPC NIL)

(SETTEMPLATE 'CL:MAPCAN NIL)

(SETTEMPLATE 'CL:MAPCAR NIL)

(SETTEMPLATE 'CL:MAPCON NIL)

(SETTEMPLATE 'CL:MAPHASH NIL)

(SETTEMPLATE 'CL:MAPL NIL)

(SETTEMPLATE 'CL:MAPLIST NIL)

(SETTEMPLATE 'CL:MEMBER NIL)

(SETTEMPLATE 'CL:MEMBER-IF NIL)

(SETTEMPLATE 'CL:MEMBER-IF-NOT NIL)

(SETTEMPLATE 'CL:MERGE NIL)

(SETTEMPLATE 'CL:MISMATCH NIL)

(SETTEMPLATE 'CL:MULTIPLE-VALUE-CALL NIL)

(SETTEMPLATE 'CL:MULTIPLE-VALUE-PROG1 NIL)

(SETTEMPLATE 'CL:MULTIPLE-VALUE-SETQ NIL)

(SETTEMPLATE 'CL:NINTERSECTION NIL)

(SETTEMPLATE 'CL:NRECONC NIL)

(SETTEMPLATE 'CL:NREVERSE NIL)

(SETTEMPLATE 'CL:NSET-DIFFERENCE NIL)

(SETTEMPLATE 'CL:NSET-EXCLUSIVE-OR NIL)

(SETTEMPLATE 'CL:NSTRING-CAPITALIZE NIL)

(SETTEMPLATE 'CL:NSTRING-DOWNCASE NIL)

(SETTEMPLATE 'CL:NSTRING-UPCASE NIL)

(SETTEMPLATE 'CL:NSUBLIS NIL)

(SETTEMPLATE 'CL:NSUBST NIL)

(SETTEMPLATE 'CL:NSUBST-IF NIL)

(SETTEMPLATE 'CL:NSUBST-IF-NOT NIL)

(SETTEMPLATE 'CL:NSUBSTITUTE NIL)

(SETTEMPLATE 'CL:NSUBSTITUTE-IF NIL)

(SETTEMPLATE 'CL:NSUBSTITUTE-IF-NOT NIL)

(SETTEMPLATE 'CL:NUNION NIL)

(SETTEMPLATE 'OPEN NIL)

(SETTEMPLATE 'CL:PARSE-INTEGER NIL)

(SETTEMPLATE 'CL:PARSE-NAMESTRING NIL)

(SETTEMPLATE 'CL:POP NIL)

(SETTEMPLATE 'CL:POSITION NIL)

(SETTEMPLATE 'CL:POSITION-IF NIL)

(SETTEMPLATE 'CL:POSITION-IF-NOT NIL)

(SETTEMPLATE 'CL:PROGV NIL)

(SETTEMPLATE 'CL:PSETF NIL)

(SETTEMPLATE 'CL:PSETQ NIL)

(SETTEMPLATE 'CL:PUSH NIL)

(SETTEMPLATE 'CL:PUSHNEW NIL)

(SETTEMPLATE 'CL:RASSOC NIL)

(SETTEMPLATE 'CL:READ-FROM-STRING NIL)

(SETTEMPLATE 'CL:REDUCE NIL)

(SETTEMPLATE 'CL:REMF NIL)

(SETTEMPLATE 'CL:REMOVE NIL)

(SETTEMPLATE 'CL:REMOVE-DUPLICATES NIL)

(SETTEMPLATE 'CL:REMOVE-IF NIL)

(SETTEMPLATE 'CL:REMOVE-IF-NOT NIL)

(SETTEMPLATE 'CL:REPLACE NIL)

(SETTEMPLATE 'CL:ROTATEF NIL)

(SETTEMPLATE 'CL:SEARCH NIL)

(SETTEMPLATE 'CL:SET-DIFFERENCE NIL)

(SETTEMPLATE 'CL:SET-EXCLUSIVE-OR NIL)

(SETTEMPLATE 'CL:SHIFTF NIL)

(SETTEMPLATE 'CL:SORT NIL)

(SETTEMPLATE 'CL:STABLE-SORT NIL)

(SETTEMPLATE 'CL:STRING-CAPITALIZE NIL)

(SETTEMPLATE 'CL:STRING-DOWNCASE NIL)

(SETTEMPLATE 'STRING-EQUAL NIL)

(SETTEMPLATE 'CL:STRING-GREATERP NIL)

(SETTEMPLATE 'CL:STRING-LESSP NIL)

(SETTEMPLATE 'CL:STRING-NOT-EQUAL NIL)

(SETTEMPLATE 'CL:STRING-NOT-GREATERP NIL)

(SETTEMPLATE 'CL:STRING-NOT-LESSP NIL)

(SETTEMPLATE 'CL:STRING-UPCASE NIL)

(SETTEMPLATE 'CL:STRING/= NIL)

(SETTEMPLATE 'CL:STRING< NIL)

(SETTEMPLATE 'CL:STRING<= NIL)

(SETTEMPLATE 'CL:STRING= NIL)

(SETTEMPLATE 'CL:STRING> NIL)

(SETTEMPLATE 'CL:STRING>= NIL)

(SETTEMPLATE 'CL:SUBLIS NIL)

(SETTEMPLATE 'CL:SUBSETP NIL)

(SETTEMPLATE 'CL:SUBST NIL)

(SETTEMPLATE 'CL:SUBST-IF NIL)

(SETTEMPLATE 'CL:SUBST-IF-NOT NIL)

(SETTEMPLATE 'CL:SUBSTITUTE NIL)

(SETTEMPLATE 'CL:SUBSTITUTE-IF NIL)

(SETTEMPLATE 'CL:SUBSTITUTE-IF-NOT NIL)

(SETTEMPLATE 'CL:TREE-EQUAL NIL)

(SETTEMPLATE 'CL:UNION NIL)

(SETTEMPLATE 'CL:VECTOR-PUSH NIL)

(SETTEMPLATE 'CL:VECTOR-PUSH-EXTEND NIL)

(SETTEMPLATE 'WRITE NIL)

(SETTEMPLATE 'CL:WRITE-LINE NIL)

(SETTEMPLATE 'CL:WRITE-STRING NIL)

(SETTEMPLATE 'CL:WRITE-TO-STRING NIL)


(* |;;| "First tell Masterscope how to find FUNCTIONS and VARIABLES")


(MSADDANALYZE 'VARIABLES 'VARIABLE 'VARIABLES 'VARIABLESMSGETDEF)

(MSADDANALYZE 'FUNCTIONS 'FUNCTION 'FUNCTIONS 'FUNCTIONSMSGETDEF 'FUNCTIONSMSMC)


(* |;;| "Then add KEYWORD support.  Templates may now contain the following as their last element:")



(* |;;| "... KEYWORDS list of keywords accepted)")



(* |;;| "No (list of keywords accepted) means use keywords gathered from analyzed source.  This must naturally be last in a template.")


(MSADDRELATION '(ACCEPT ACCEPTS ACCEPTING ACCEPTED)
       '(KEYACCEPT))

(MSADDRELATION '(SPECIFY SPECIFIES SPECIFYING SPECIFIED)
       '(KEYSPECIFY))

(MSADDRELATION '(KEYCALL KEYCALLS KEYCALLING KEYCALLED))

(MSADDMODIFIER 'ACCEPT 'KEYWORD 'KEYACCEPT)

(MSADDMODIFIER 'ACCEPT 'KEYWORDS 'KEYACCEPT)

(MSADDMODIFIER 'SPECIFY 'KEYWORD 'KEYSPECIFY)

(MSADDMODIFIER 'SPECIFY 'KEYWORDS 'KEYSPECIFY)


(* |;;| 
"Stuff for locally-defined things.  We don't attempt to handle them (*sigh*), just record them.")


(MSADDRELATION '(FLET FLETS FLETTING FLET))

(MSADDRELATION '(LABEL LABELS LABELLING LABELLED))

(MSADDRELATION '(MACROLET MACROLETS MACROLETTING MACROLET))

(MSADDRELATION '(LOCAL-DEFINE LOCAL-DEFINES LOCAL-DEFINING LOCAL-DEFINED)
       '(FLET LABEL MACROLET))


(* |;;| "What the heck, track COMPILER-LETs.")


(MSADDRELATION '(COMPILER-LET COMPILER-LETS COMPILER-LETTING COMPILER-LETTED))


(* |;;| "Finally, copy the templates over into MSTEMPLATES and clear the USERTEMPLATES table now; no need for the Common Lisp templates to live there.")


(MAPHASH USERTEMPLATES #'(LAMBDA (VAL KEY)
                           (PUTHASH KEY VAL MSTEMPLATES)))

(CLRHASH USERTEMPLATES)
(PUTPROPS MSCOMMON COPYRIGHT ("Venue & Xerox Corporation" 1988 1990 1992))
(DECLARE\: DONTCOPY
  (FILEMAP (NIL (4967 7124 (FUNCTIONSMSGETDEF 4977 . 6117) (FUNCTIONSMSMC 6119 . 6599) (
VARIABLESMSGETDEF 6601 . 7122)))))
STOP
